# 油联合伙人逆向

## 抓包分析请求

1. 先打开抓包工具

2. 在手机或者模拟器上打开app

3. 抓取登录请求

4. 分析登录请求
   1. 请求体
      - 密码进行了加密
   2. 请求头
      - X-Sign参数进行了加密

## 脱壳app

使用jadx来完成，找到你机器上的jadx的位置，双击执行`jadx-gui.bat`

![image-20220913203703337](assets\image-20220913203703337.png)

将油联合伙人的apk文件拖到打开的界面中，就能得到源码了

![image-20220913203928121](assets\image-20220913203928121.png)

## 请求体分析

password是加密的，搜索的方法

- 搜索url

- 搜索password关键字
- 搜索其他请求体中的关键字，可能是在一起的

通过搜索找到对应请求的位置：

![image-20220913204124637](assets\image-20220913204124637.png)

双击进入到代码，可以看出这是使用`retrofit`来发送请求的。要找到谁使用了`submitLogin`这个函数来看密码是怎么加密的

- 全局搜索`submitLogin`来看哪里使用了
- 函数名处 鼠标右键->查找用例 来看哪里使用了

![image-20220913204404778](assets\image-20220913204404778.png)

只有一处使用了

![image-20220913204444409](assets\image-20220913204444409.png)

依次就能找到密码机密的位置，密码是md5加密。

![image-20220913204638707](assets\image-20220913204638707.png)

md5可能会加盐，要在盐也只能是在md5方法中，所以**右键->跳转申明**，看函数声明除有没有进行加盐，如果有就要找到加的是什么盐。

可以看到没有加盐

![image-20220913210321990](assets\image-20220913210321990.png)

到这里，就可以使用python来实现md5加密，对加密的结果和安卓中加密的结果进行对比，如果一致，说明密码的加密我们已经解决了。



当全局搜索，有多个搜索结果是：

在找到过程中注意节点下面的包名，先看和声明在同一个包中的代码，还要注意包名中的关键字和你想要找的是否有匹配到

- 查看包名中是否有和自己要找的名字有重复的先看
- 和声明在同一个包中的先看
- 最后看其他的搜索结果

**注意：**右键->查找用例，这样的方式并不是万能的，不一定能全部找到，我们是先通过这种方式进行尝试，能找到最好，找不到再使用全局搜索的方式来找。

## 请求头分析

在请求头中只有`X-Sign`是加密的，搜索方式

- 搜索`X-Sign`关键字
- 搜索其他请求头中的关键字，可能是在一起的
- 如果请求头中有很多请求都带了同一个key，说明这个请求头key的值可能是在拦截器中生成的

搜索`X-Sign`关键字

![image-20220913212115288](assets\image-20220913212115288.png)

很棒，只有一个结果，而且在包名中看到了拦截器的关键字`interceptors`，所以猜测`X-Sign`有很大可能是在拦截器中生成的。

进入代码中，可以看到，`X-sign`复制给了一个静态常量，之后就是要看这个常量在哪里使用了。

![image-20220913212339523](assets\image-20220913212339523.png)

可以看到，这里定义的静态常量都是请求头中的key。双击选中，这个常量名就高亮了，在当前文件中，只要有这个常量的地方都会高亮起来，可以鼠标滑动找到使用的地方，也可以在这个文件中`ctrl+F5`来进行所有使用的地方。





